var e=(e,t,o)=>new Promise(((n,i)=>{var r=e=>{try{a(o.next(e))}catch(t){i(t)}},s=e=>{try{a(o.throw(e))}catch(t){i(t)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,s);a((o=o.apply(e,t)).next())}));!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const t={};var o=(e=>(e.TRASH="Trash",e.RECYCLABLE="Recyclable",e.COMPOST="Compost",e.EWASTE="E-Waste",e))(o||{});const n=["bottle","box","computer keyboard","food","mobile phone","plastic bag","tin can"],i={bottle:{category:o.RECYCLABLE,info:"Whether made in plastic or glass, they are recyclable. Just make sure they're clean!"},box:{category:o.RECYCLABLE,info:"Boxes are typically made of cardboard, and are recyclable. Just make sure they're clean!"},"computer keyboard":{category:o.EWASTE,info:"Electronic devices like keyboards should be disposed of at specialized e-centers."},food:{category:o.COMPOST,info:"Food goes in the compost!"},"mobile phone":{category:o.EWASTE,info:"Electronic devices like phones should be disposed of at specialized e-centers."},"plastic bag":{category:o.TRASH,info:"Plastic bags can be reused. Otherwise, they must be thrown in the garbage."},"tin can":{category:o.RECYCLABLE,info:"Metal cans can be recycled!"}},r={[o.COMPOST]:{image:new Image,url:"/assets/compost-icon.8b0629af.svg"},[o.EWASTE]:{image:new Image,url:"/assets/e-waste-icon.d05574cf.svg"},[o.TRASH]:{image:new Image,url:"/assets/trash-icon.8c441624.svg"},[o.RECYCLABLE]:{image:new Image,url:"/assets/recycle-icon.cb44ed7f.svg"}};for(const P of Object.values(r))P.image.src=P.url;const s=document.getElementById("canvas"),a=document.getElementById("hidden-canvas"),c=document.getElementById("video"),d=document.getElementById("supported-objects"),l=document.getElementById("status-info"),h=document.getElementById("modal"),m=document.getElementById("modal-foreground"),g=document.getElementById("modal-close-button"),u=document.getElementById("modal-icon"),y=document.getElementById("modal-title"),f=document.getElementById("modal-image"),p=document.getElementById("modal-description"),E=document.getElementById("confirmation-button"),b=document.getElementById("confirmation"),v=e=>{l.textContent=e,l.style.display=e?"block":"none"},w=()=>{h.style.display="none"};let x=!0;const L=(t,o,n,i)=>e(this,null,(function*(){i.current=yield o.detect(t,{numResults:10,threshold:.6}),x&&(v(""),x=!1),C(n,i),requestAnimationFrame((()=>{L(t,o,n,i)}))})),C=(e,t,o=!1)=>{const n=e.getContext("2d");if(!n)return;n.clearRect(0,0,e.width,e.height);const s=Math.sqrt(e.width*e.height)/10;t.current.forEach((e=>{const t=e.bndBox,a=i[e.class].category,c=t.x-s/2+t.width/2,d=t.y-s/2+t.height/2;o&&(n.strokeStyle="#00ff00",n.font="20px Courier",n.strokeRect(t.x,t.y,t.width,t.height),n.strokeText(`${e.class}: ${(100*e.confidence).toFixed(1)}%`,t.x,t.y-5)),n.drawImage(r[a].image,c,d,s,s)}))},I=e=>e.split(" ").map((e=>e[0].toLocaleUpperCase()+e.substr(1))).join(" ");h.addEventListener("click",w),m.addEventListener("click",(e=>{e.stopPropagation()})),g.addEventListener("click",w),d.textContent=n.join(", ");const k={current:[]};let B=null;E.addEventListener("click",(()=>{b.style.display="none",c.style.display="block",s.style.display="block",A()}));const A=()=>e(this,null,(function*(){s.addEventListener("click",T),c.addEventListener("loadedmetadata",R),v("Requesting access to camera");try{yield S()}catch(e){return console.error(e),void v("Cannot access camera. this app requires a camera to work.")}})),R=()=>{(()=>{e(this,null,(function*(){v("Loading app...");try{const n=yield(e=()=>import("./tfjs.model.b9b7aa54.js"),o=[],o&&0!==o.length?Promise.all(o.map((e=>{if((e=`/${e}`)in t)return;t[e]=!0;const o=e.endsWith(".css"),n=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const i=document.createElement("link");return i.rel=o?"stylesheet":"modulepreload",o||(i.as="script",i.crossOrigin=""),i.href=e,document.head.appendChild(i),o?new Promise(((t,o)=>{i.addEventListener("load",t),i.addEventListener("error",(()=>o(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e())):e());B=n.default,yield B.init("https://raw.githubusercontent.com/cristian-aldea/mull-model/main/tfjs-2/model.json")}catch(n){return console.error(n),void v("Failed to load app, your device might not be supported :(")}var e,o;v("App loaded successfully! Finishing up..."),L(c,B,s,k)}))})()},S=()=>e(this,null,(function*(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw"Either no camera exists on your device, or your browser denied access to it";{const e=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1e3},height:{ideal:800}},audio:!1});c.srcObject=e,c.play(),c.onloadedmetadata=()=>{s.width=c.videoWidth,s.height=c.videoHeight}}})),T=e=>{const t=e.target,o=((e,t)=>{const o={x:0,y:0};if(e.width/e.height>t.width/t.height){o.y=e.y/e.height*t.height;const n=e.height/t.height*t.width,i=(e.width-n)/2;o.x=(e.x-i)/n*t.width}else{o.x=e.x/e.width*t.width;const n=e.width/t.width*t.height,i=(e.height-n)/2;o.y=(e.y-i)/n*t.height}return o})({x:e.offsetX,y:e.offsetY,width:t.clientWidth,height:t.clientHeight},{width:t.width,height:t.height}),n=k.current.filter((e=>{return t=o,n=e.bndBox,t.x>n.x&&t.x<n.x+n.width&&t.y>n.y&&t.y<n.y+n.height;var t,n}));if(n.length>0){const e=n[0];((e,t)=>{const o=i[e.class];u.src=r[o.category].url,y.textContent=I(e.class),f.src=t,p.textContent=`This seems to be ${"food"!==e.class?"a ":""}${e.class}. ${o.info}`,h.style.display="block"})(e,O(e))}},O=e=>{const t=e.bndBox,o=a.getContext("2d");if(!o)return console.error("getImageURL - Error getting ctx"),"";a.width=c.videoWidth,a.height=c.videoHeight,o.drawImage(c,0,0);const n=o.getImageData(t.x,t.y,t.width,t.height);return a.width=n.width,a.height=n.height,o.putImageData(n,0,0),a.toDataURL()};export{n as w};
